<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Khadija Aabdi ‚Äî A Little Question</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --accent1: #ff9bb3;
    --accent2: #d96f91;
    --muted: #6b5960;
    --bgA: #fff7fb;
    --bgB: #f3fbff;
    --card-color: rgba(255,255,255,0.92);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{
    background: linear-gradient(120deg,var(--bgA),var(--bgB));
    overflow-x:hidden;
    display:flex;align-items:center;justify-content:center;padding:28px;
    color:#2f2126;
  }

  /* animated gradient background pane */
  .ambient {
    position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden;
    background: radial-gradient(600px 400px at 10% 20%, rgba(255,215,230,0.6), transparent 10%),
                radial-gradient(500px 350px at 85% 80%, rgba(220,245,255,0.6), transparent 12%),
                radial-gradient(300px 200px at 50% 10%, rgba(255,240,245,0.4), transparent 6%);
    animation:ambientMove 16s linear infinite;
    filter: blur(18px) saturate(1.05);
  }
  @keyframes ambientMove {
    0%{transform:translateY(0) rotate(0deg)}
    50%{transform:translateY(20px) rotate(2deg)}
    100%{transform:translateY(0) rotate(0deg)}
  }

  .container{position:relative;z-index:2;max-width:920px;width:100%;display:flex;align-items:center;justify-content:center;padding:36px}
  .card{
    width:100%;max-width:880px;border-radius:22px;padding:28px 34px;background:linear-gradient(180deg, var(--card-color), rgba(255,252,254,0.9));
    box-shadow:0 20px 60px rgba(44,20,28,0.12);position:relative;overflow:hidden;
    border:1px solid rgba(217,111,145,0.06);
  }

  header{display:flex;gap:18px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .title {
    display:flex;flex-direction:column;align-items:flex-start;
  }
  h1{
    margin:0;font-family:'Great Vibes',cursive;font-size:58px;color:var(--accent2);letter-spacing:0.6px;text-shadow:0 6px 18px rgba(217,111,145,0.08);
  }
  .sub{color:var(--muted);font-size:16px;margin-top:6px}

  .poem{
    margin-top:18px;padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,245,248,0.6), rgba(255,255,255,0.6));
    border:1px solid rgba(217,111,145,0.08);font-size:15px;color:#4a3a3f;line-height:1.5;opacity:0;transform:translateY(12px);
    transition:all 700ms cubic-bezier(.2,.9,.25,1);
  }
  .poem.show{opacity:1;transform:translateY(0)}

  .message{margin-top:18px;font-size:16px;color:#4b3b40}

  .controls{display:flex;gap:12px;margin-top:22px;align-items:center;flex-wrap:wrap}
  .btn{
    padding:12px 18px;border-radius:999px;border:0;cursor:pointer;font-weight:700;letter-spacing:0.2px;font-size:15px;
    transition:transform .18s ease, box-shadow .18s ease;
    box-shadow:0 8px 28px rgba(40,20,30,0.06);
  }
  .btn:active{transform:scale(.98)}
  .btn-yes{
    background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;
    box-shadow:0 14px 38px rgba(217,111,145,0.18);
  }
  .btn-yes.glow{animation:glow 2.4s infinite}
  @keyframes glow{
    0%{box-shadow:0 10px 30px rgba(217,111,145,0.10)}
    50%{box-shadow:0 20px 60px rgba(217,111,145,0.22)}
    100%{box-shadow:0 10px 30px rgba(217,111,145,0.10)}
  }
  .btn-more{background:transparent;border:1px solid rgba(220,200,210,0.35);color:var(--muted)}
  .tiny{font-size:13px;color:#a18690;margin-top:12px}

  /* extra sections */
  .extras{display:grid;grid-template-columns:1fr 320px;gap:18px;margin-top:18px}
  .panel{background:rgba(255,255,255,0.85);padding:14px;border-radius:12px;border:1px solid rgba(217,111,145,0.06)}
  .reasons h3{margin:0 0 8px 0;color:var(--accent2);font-size:18px}
  .reasons ul{list-style:none;padding-left:0;color:#4a3a3f}
  .timeline{font-size:14px;color:#584145;line-height:1.45}
  .gallery{display:flex;gap:8px;flex-wrap:wrap}
  .thumb{width:72px;height:72px;border-radius:8px;background:#ffeef4;border:1px solid rgba(217,111,145,0.08);display:inline-flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}

  /* modal */
  .backdrop{position:fixed;inset:0;background:rgba(10,8,10,0.45);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:all .25s ease;z-index:30}
  .backdrop.show{opacity:1;pointer-events:auto}
  .modal{
    width:96%;max-width:520px;border-radius:16px;padding:22px;background:linear-gradient(180deg,#ffffff,#fff8fb);box-shadow:0 40px 80px rgba(18,10,12,0.4);transform:translateY(10px);transition:transform .28s ease;
  }
  .backdrop.show .modal{transform:translateY(0)}

  .modal h2{margin:0;font-family:'Great Vibes',cursive;color:var(--accent2);font-size:34px;text-align:center}
  .modal p{color:var(--muted);text-align:center;margin:8px 0 12px}
  .form-field{display:block;margin-top:10px}
  input[type="email"], textarea{
    width:100%;padding:12px;border-radius:10px;border:1px solid #efe7ea;font-size:14px;resize:none;font-family:inherit;
  }
  .row{display:flex;gap:8px;margin-top:12px}
  .col{flex:1}
  .submit-row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:14px}
  .submit-btn{flex:1;padding:12px;border-radius:999px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;font-weight:700;cursor:pointer}
  .ghost{background:transparent;border:1px solid rgba(200,160,170,0.25);color:var(--muted);padding:10px;border-radius:999px;cursor:pointer}

  /* heart trail */
  .trail { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:6; overflow:hidden; }

  .heart-dot{position:absolute;font-size:18px;opacity:0;transform:scale(0.8);transition:all 600ms ease;filter:drop-shadow(0 6px 12px rgba(217,111,145,0.12));}

  /* confetti canvas area (just absolute children) */
  .confetti-layer{position:fixed;inset:0;pointer-events:none;z-index:28;overflow:hidden}

  /* final overlay */
  .final-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(255,255,255,0.94), rgba(255,248,250,0.96));opacity:0;pointer-events:none;transition:all .3s ease;z-index:40}
  .final-overlay.show{opacity:1;pointer-events:auto}
  .final-card{padding:28px;border-radius:18px;text-align:center;max-width:720px;box-shadow:0 40px 90px rgba(28,14,20,0.18);}

  /* gallery modal */
  .img-modal{max-width:90vw;max-height:90vh;border-radius:12px;overflow:hidden}
  .img-modal img{width:100%;height:100%;object-fit:cover;display:block}

  /* print card */
  .print-card{display:none}
  @media print{
    body *{visibility:hidden}
    .print-card, .print-card *{visibility:visible}
    .print-card{display:block;position:fixed;left:0;top:0;width:100%}
  }

  /* mobile tweaks */
  @media (max-width:760px){
    .extras{grid-template-columns:1fr;gap:12px}
    h1{font-size:44px}
    .modal h2{font-size:28px}
    .card{padding:20px}
  }
</style>
</head>
<body>

<div class="ambient" aria-hidden="true"></div>
<div class="trail" id="trail"></div>
<div class="confetti-layer" id="confettiLayer" aria-hidden="true"></div>

<div class="container">
  <div class="card" role="main" id="card">
    <header>
      <div class="title">
        <h1>For Khadija Aabdi</h1>
        <div class="sub">A small page with a big question ‚Äî made with love by Hashim</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end">
        <div style="font-size:13px;color:#b18591">üíñ Premium Proposal</div>
        <div style="margin-top:6px;font-size:12px;color:#b0959c">Open on a quiet moment</div>
      </div>
    </header>

    <section class="poem" id="poem">
      <em>"Your laughter is the sunrise I chase; your silence is the calm I keep ‚Äî with you my little world feels complete."</em>
    </section>

    <p class="message" id="msg">Khadija, every moment with you feels gentle and true. I could write a thousand pages and still not find the right words ‚Äî so I made this tiny place just for you.</p>

    <div class="controls">
      <button class="btn btn-yes glow" id="askBtn">Will you be mine?</button>
      <button class="btn btn-more" id="readMoreBtn">Read a little more...</button>

      <!-- New controls: play/pause music, share, print -->
      <button class="btn" id="musicToggle" title="Play / Pause music">Play Music</button>
      <button class="btn" id="shareBtn" title="Share via email">Share</button>
      <button class="btn" id="printBtn" title="Print love letter">Print</button>
    </div>

    <div class="extras" aria-hidden="false">
      <div class="panel reasons">
        <h3>Why I love you</h3>
        <ul>
          <li>‚Äî Your laughter makes everything bright.</li>
          <li>‚Äî You understand the little things I never say.</li>
          <li>‚Äî With you I feel calm, safe and myself.</li>
          <li>‚Äî You‚Äôre kind, brave and so gentle-hearted.</li>
        </ul>

        <div style="margin-top:12px">
          <h3 style="font-size:16px;margin-bottom:6px;color:var(--accent2)">A tiny timeline</h3>
          <div class="timeline">
            <strong>First hello</strong> ‚Äî the moment I smiled for the first time because of you.<br>
            <strong>Our first walk</strong> ‚Äî I remember how the world felt softer.<br>
            <strong>Every day</strong> ‚Äî I keep collecting these gentle moments.
          </div>
        </div>
      </div>

      <div class="panel">
        <h3 style="color:var(--accent2);margin-top:0">Memories & Gallery</h3>
        <div class="gallery" id="gallery">
          <!-- placeholders: replace src with your images -->
          <div class="thumb" data-full="https://picsum.photos/800/600?1"><img src="https://picsum.photos/200/200?1" alt="mem1"></div>
          <div class="thumb" data-full="https://picsum.photos/800/600?2"><img src="https://picsum.photos/200/200?2" alt="mem2"></div>
          <div class="thumb" data-full="https://picsum.photos/800/600?3"><img src="https://picsum.photos/200/200?3" alt="mem3"></div>
          <div class="thumb" data-full="https://picsum.photos/800/600?4"><img src="https://picsum.photos/200/200?4" alt="mem4"></div>
        </div>

        <div style="margin-top:10px;font-size:13px;color:#a18690">Click an image to enlarge</div>
      </div>
    </div>

    <div class="tiny">‚Äî with all my heart, Hashim</div>
  </div>
</div>

<!-- Modal (form & choice) -->
<div class="backdrop" id="backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-labelledby="modalTitle">
    <h2 id="modalTitle">Khadija ‚Äî your answer</h2>
    <p>Pick Yes/No and optionally send me a short message (it reaches my email)</p>

    <form id="replyForm" action="https://formspree.io/f/xwpaeaka" method="POST">
      <input type="hidden" name="choice" id="choiceField" value="">
      <div class="form-field">
        <input type="email" name="email" id="emailField" placeholder="Your email (optional)">
      </div>
      <div class="form-field">
        <textarea name="message" rows="4" placeholder="Leave a message‚Ä¶ (optional)"></textarea>
      </div>

      <div class="submit-row">
        <div class="row" style="flex:1">
          <button type="button" class="ghost" id="yesChoice">Yes üíñ</button>
          <button type="button" class="ghost" id="noChoice">No üò¢</button>
        </div>
        <button type="submit" class="submit-btn" id="sendResponse" style="display:none">Send Response</button>
      </div>
    </form>

    <div style="margin-top:10px;font-size:13px;color:#a18690">You can change your answer before sending. I‚Äôll be grateful either way.</div>
  </div>
</div>

<!-- Gallery modal -->
<div class="backdrop" id="imgBackdrop" aria-hidden="true">
  <div class="modal img-modal" id="imgModal" style="padding:0">
    <img src="" alt="full" id="imgFull">
  </div>
</div>

<!-- Final Overlay -->
<div class="final-overlay" id="finalOverlay" aria-hidden="true">
  <div class="final-card" id="finalCard">
    <!-- content injected by JS -->
  </div>
</div>

<!-- Printable love letter (hidden) -->
<aside class="print-card" id="printCard">
  <div style="padding:36px;font-family:Inter,Arial;color:#2f2126">
    <h1 style="font-family:'Great Vibes',cursive;color:var(--accent2);font-size:48px;margin:0">For Khadija Aabdi</h1>
    <p style="margin-top:14px;color:var(--muted)">A small page with a big question ‚Äî made with love by Hashim</p>
    <hr style="margin:18px 0;border:none;border-top:1px solid rgba(217,111,145,0.12)">
    <blockquote style="font-size:18px;color:#4a3a3f">"Your laughter is the sunrise I chase; your silence is the calm I keep ‚Äî with you my little world feels complete."</blockquote>
    <p style="margin-top:12px;font-size:16px;color:#4b3b40">Khadija, every moment with you feels gentle and true. I could write a thousand pages and still not find the right words ‚Äî so I made this tiny place just for you.</p>
    <p style="margin-top:24px;color:#8a6a6f">‚Äî with all my heart, Hashim</p>
  </div>
</aside>

<!-- Optional audio files: replace with your files in same folder -->
<audio id="bgMusic" src="music.mp3" loop preload="auto"></audio>
<audio id="yesSound" src="yes-sound.mp3" preload="auto"></audio>
<audio id="noSound" src="no-sound.mp3" preload="auto"></audio>

<script>
/* ---------- Helpers & Elements ---------- */
const askBtn = document.getElementById('askBtn');
const readMoreBtn = document.getElementById('readMoreBtn');
const poem = document.getElementById('poem');
const backdrop = document.getElementById('backdrop');
const yesChoice = document.getElementById('yesChoice');
const noChoice = document.getElementById('noChoice');
const choiceField = document.getElementById('choiceField');
const sendResponse = document.getElementById('sendResponse');
const replyForm = document.getElementById('replyForm');
const finalOverlay = document.getElementById('finalOverlay');
const finalCard = document.getElementById('finalCard');
const confettiLayer = document.getElementById('confettiLayer');
const trail = document.getElementById('trail');
const bgMusic = document.getElementById('bgMusic');
const yesSound = document.getElementById('yesSound');
const noSound = document.getElementById('noSound');
const musicToggle = document.getElementById('musicToggle');
const shareBtn = document.getElementById('shareBtn');
const printBtn = document.getElementById('printBtn');
const gallery = document.getElementById('gallery');
const imgBackdrop = document.getElementById('imgBackdrop');
const imgFull = document.getElementById('imgFull');
const imgModal = document.getElementById('imgModal');
const imgModalBackdrop = imgBackdrop;

/* Autoplay music softly (try; browser may block, user may click to allow) */
function tryPlayMusic(){
  bgMusic.volume = 0.25;
  bgMusic.play().catch(()=>{/* user interaction required */});
}
setTimeout(tryPlayMusic, 800);

/* show poem after a delay with nice entrance */
setTimeout(()=>poem.classList.add('show'), 900);

/* open modal */
askBtn.addEventListener('click', ()=>{ openBackdrop(); });

/* read more fade */
readMoreBtn.addEventListener('click', ()=>{
  poem.classList.toggle('show');
  if(poem.classList.contains('show')) poem.scrollIntoView({behavior:'smooth',block:'center'});
});

/* music toggle */
let musicPlaying = false;
musicToggle.addEventListener('click', ()=>{
  if(!musicPlaying){
    bgMusic.volume = 0.35;
    bgMusic.play().catch(()=>{});
    musicToggle.textContent = 'Pause Music';
    musicPlaying = true;
  } else {
    bgMusic.pause();
    musicToggle.textContent = 'Play Music';
    musicPlaying = false;
  }
});

/* share btn (mailto quick share) */
shareBtn.addEventListener('click', ()=>{
  const subject = encodeURIComponent('A small question for you, Khadija');
  const body = encodeURIComponent('I made a little page for you. Open it when you\'re ready ‚Äî with love, Hashim.\n\n(You can reply directly from the page.)');
  window.location.href = `mailto:?subject=${subject}&body=${body}`;
});

/* print btn */
printBtn.addEventListener('click', ()=>{
  window.print();
});

/* open/backdrop helpers */
function openBackdrop(){
  backdrop.classList.add('show');
  backdrop.setAttribute('aria-hidden','false');
}
function closeBackdrop(){
  backdrop.classList.remove('show');
  backdrop.setAttribute('aria-hidden','true');
}

/* gallery thumbnail click */
gallery.querySelectorAll('.thumb').forEach(t=>{
  t.addEventListener('click', ()=>{
    const src = t.getAttribute('data-full');
    imgFull.src = src;
    imgBackdrop.classList.add('show');
    imgBackdrop.setAttribute('aria-hidden','false');
  });
});
imgBackdrop.addEventListener('click', (e)=>{
  if(e.target === imgBackdrop || e.target === imgModal){
    imgBackdrop.classList.remove('show');
    imgBackdrop.setAttribute('aria-hidden','true');
    imgFull.src = '';
  }
});

/* choice handlers */
yesChoice.addEventListener('click', ()=>{
  choiceField.value = "Yes";
  sendResponse.style.display = 'inline-block';
  // immediate celebration UI
  playYes();
  replyForm.message && (replyForm.message.value = replyForm.message.value || "Yes ‚Äî I would love to üíñ");
});
noChoice.addEventListener('click', ()=>{
  choiceField.value = "No";
  sendResponse.style.display = 'inline-block';
  playNo();
  replyForm.message && (replyForm.message.value = replyForm.message.value || "I‚Äôm sorry ‚Äî I can‚Äôt. I wish you all the best.");
});

/* form submission: show sending animation and final overlay */
replyForm.addEventListener('submit', (e)=>{
  e.preventDefault();
  sendResponse.disabled = true;
  sendResponse.textContent = 'Sending‚Ä¶';
  const data = new FormData(replyForm);

  // store locally
  try{
    const prev = JSON.parse(localStorage.getItem('proposal_responses') || '[]');
    prev.push({choice: choiceField.value, email: replyForm.email && replyForm.email.value, message: replyForm.message && replyForm.message.value, time: new Date().toISOString()});
    localStorage.setItem('proposal_responses', JSON.stringify(prev));
  }catch(err){console.warn('save error', err);}

  fetch(replyForm.action, {method:'POST', body: data, headers: {'Accept': 'application/json'}})
    .then(response => response.json().catch(()=>({ok:false})))
    .then(json => {
      showFinal(choiceField.value);
      sendResponse.textContent = 'Sent ‚úì';
      sendResponse.disabled = true;
      closeBackdrop();
    })
    .catch(err => {
      console.warn('submit error', err);
      showFinal(choiceField.value, true);
      sendResponse.textContent = 'Sent ‚úì';
      sendResponse.disabled = true;
      closeBackdrop();
    });
});

/* close modal when clicking outside or pressing Esc */
backdrop.addEventListener('click', (e)=>{
  if(e.target === backdrop) closeBackdrop();
});
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') {
    closeBackdrop();
    imgBackdrop.classList.remove('show');
    imgBackdrop.setAttribute('aria-hidden','true');
  }
});

/* ---------- Visual Effects ---------- */

/* play yes: confetti + sound + floating hearttrail + rose drop */
function playYes(){
  try{ yesSound.volume = 0.9; yesSound.currentTime = 0; yesSound.play().catch(()=>{});}catch(e){}
  spawnConfetti(28);
  spawnHearts(8);
  pulseCard();
  showRoseDrop(); // special
}
/* play no: sad sound + shake */
function playNo(){
  try{ noSound.volume = 0.9; noSound.currentTime = 0; noSound.play().catch(()=>{});}catch(e){}
  shakeCard();
  spawnTearEmojis();
}

/* card pulse when yes */
function pulseCard(){
  const card = document.getElementById('card');
  card.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}],{duration:800, easing:'ease-out'});
}

/* shake card for no */
function shakeCard(){
  const card = document.getElementById('card');
  card.animate([{transform:'translateX(0)'},{transform:'translateX(-8px)'},{transform:'translateX(8px)'},{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:700});
}

/* confetti pieces */
function spawnConfetti(count){
  const colors = ['#ffd6e0','#ffb3c7','#ffd7e6','#d96f91'];
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'confetti';
    el.style.position = 'absolute';
    el.style.left = (10 + Math.random()*80) + '%';
    el.style.top = '-10%';
    el.style.width = (6 + Math.random()*10) + 'px';
    el.style.height = (10 + Math.random()*18) + 'px';
    el.style.background = colors[i%colors.length];
    el.style.opacity = Math.random()*0.9+0.3;
    el.style.borderRadius = '3px';
    el.style.transform = `rotate(${Math.random()*360}deg)`;
    confettiLayer.appendChild(el);
    const dur = 1600 + Math.random()*1400;
    el.animate([{transform:`translateY(0px) rotate(0deg)`},{transform:`translateY(${600 + Math.random()*200}px) rotate(${Math.random()*720}deg)`}],{duration:dur,easing:'cubic-bezier(.2,.9,.3,1)'});
    setTimeout(()=>el.remove(), dur+40);
  }
}

/* small floating hearts */
function spawnHearts(n){
  for(let i=0;i<n;i++){
    const h = document.createElement('div');
    h.className = 'heart-dot';
    h.textContent = 'üíó';
    h.style.left = (30 + Math.random()*40) + '%';
    h.style.top = (50 + Math.random()*20) + '%';
    h.style.opacity = 0;
    trail.appendChild(h);
    const dx = (Math.random()*120 - 60);
    h.animate([
      { transform:`translate(0px,0px) scale(.8)`, opacity:0 },
      { transform:`translate(${dx}px, -120px) scale(1)`, opacity:1 },
      { transform:`translate(${dx*1.2}px, -240px) scale(.9)`, opacity:0 }
    ], { duration: 1800 + Math.random()*800, easing:'cubic-bezier(.2,.9,.3,1)'});
    setTimeout(()=>h.remove(), 2200 + Math.random()*800);
  }
}

/* sad emoji rain for No */
function spawnTearEmojis(){
  for(let i=0;i<10;i++){
    const el = document.createElement('div');
    el.textContent = 'üò¢';
    el.style.position = 'absolute';
    el.style.left = (20 + Math.random()*60) + '%';
    el.style.top = '-5%';
    el.style.fontSize = (18 + Math.random()*14) + 'px';
    el.style.opacity = 0.95;
    confettiLayer.appendChild(el);
    el.animate([{transform:'translateY(0)'},{transform:`translateY(${350 + Math.random()*200}px)`}],{duration:1300 + Math.random()*600, easing:'ease-in'});
    setTimeout(()=>el.remove(), 1500 + Math.random()*700);
  }
}

/* rose drop animation (special for YES) */
function showRoseDrop(){
  const rose = document.createElement('div');
  rose.textContent = 'üåπ';
  rose.style.position = 'absolute';
  rose.style.left = (40 + Math.random()*20) + '%';
  rose.style.top = '-8%';
  rose.style.fontSize = '48px';
  rose.style.zIndex = 50;
  confettiLayer.appendChild(rose);
  rose.animate([{transform:'translateY(0) scale(0.6)', opacity:0},{transform:'translateY(320px) scale(1)', opacity:1}],{duration:900, easing:'cubic-bezier(.2,.9,.3,1)'});
  setTimeout(()=>rose.animate([{opacity:1},{opacity:0}],{duration:800}).onfinish = ()=>rose.remove(), 900);
  setTimeout(()=>rose.remove(), 2200);
}

/* mouse heart trail */
let lastTrailTime = 0;
document.addEventListener('mousemove', (e)=>{
  const now = Date.now();
  if(now - lastTrailTime < 80) return; // limit dots
  lastTrailTime = now;
  const dot = document.createElement('div');
  dot.className = 'heart-dot';
  dot.textContent = ['üíó','üíû','üíï'][Math.floor(Math.random()*3)];
  dot.style.left = (e.clientX - 8) + 'px';
  dot.style.top = (e.clientY - 8) + 'px';
  dot.style.opacity = 1;
  dot.style.fontSize = (10 + Math.random()*18) + 'px';
  trail.appendChild(dot);
  dot.animate([{transform:'translateY(0) scale(1)', opacity:1},{transform:'translateY(-48px) scale(.8)', opacity:0}],{duration:900, easing:'cubic-bezier(.2,.9,.3,1)'});
  setTimeout(()=>dot.remove(), 1000);
});

/* show final overlay after successful send or immediate yes/no quick flow */
function showFinal(choice, error=false){
  finalOverlay.classList.add('show');
  finalOverlay.setAttribute('aria-hidden','false');
  if(choice === 'Yes'){
    finalCard.innerHTML = `<h1 style="font-family:'Great Vibes',cursive;color:${getComputedStyle(document.documentElement).getPropertyValue('--accent2')};font-size:48px;margin:0">She said YES üíñ</h1>
    <p style="color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')};margin-top:12px">Thank you, Khadija. Hashim's heart is full. ‚ù§Ô∏è</p>
    <p style="margin-top:14px;color:#8a6a6f">You can close this window when you're ready.</p>`;
    spawnConfetti(40);
    try{ yesSound.play().catch(()=>{}); }catch(e){}
    // extra long rose shower
    for(let i=0;i<6;i++){ setTimeout(()=>showRoseDrop(), i*220); }
  } else if(choice === 'No'){
    finalCard.innerHTML = `<h1 style="font-family:'Great Vibes',cursive;color:#9c7b85;font-size:42px;margin:0">It's okay ‚Äî thank you</h1>
    <p style="color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')};margin-top:12px">I respect your feelings, Khadija. Wishing you happiness always.</p>`;
    spawnTearEmojis();
    try{ noSound.play().catch(()=>{}); }catch(e){}
  } else {
    finalCard.innerHTML = `<h1 style="font-family:'Great Vibes',cursive;color:${getComputedStyle(document.documentElement).getPropertyValue('--accent2')};font-size:42px;margin:0">Thanks for responding</h1>
    <p style="color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')};margin-top:12px">Your message is saved. ‚Äî Hashim</p>`;
  }

  // close overlay on click or esc
  finalOverlay.addEventListener('click', ()=> {
    finalOverlay.classList.remove('show');
    finalOverlay.setAttribute('aria-hidden','true');
  }, { once: true });
  document.addEventListener('keydown', function onesc(e){
    if(e.key === 'Escape'){ finalOverlay.classList.remove('show'); finalOverlay.setAttribute('aria-hidden','true'); document.removeEventListener('keydown', onesc); }
  });
}

/* Utility: try to enable sound on first interaction if blocked */
document.body.addEventListener('click', function unlockAudio(){
  try{ bgMusic.play().catch(()=>{}); }catch(e){}
  document.body.removeEventListener('click', unlockAudio);
});

/* Optionally show stored responses in console for debugging */
console.log('Previously saved replies:', localStorage.getItem('proposal_responses'));

/* End script */
</script>

</body>
</html>
